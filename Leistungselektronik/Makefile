# LaTeX Makefile
 
PROJECT=leistungselektronik
OUTPUT=leistungselektronik

BIBER=biber
PDFLATEX=pdflatex -file-line-error -interaction=nonstopmode -output-directory . -jobname $(OUTPUT) $(PROJECT)
BIBTEX=bibtex
RM = rm -rf

 
UNAME := $(shell uname)
 
# $(call convert_to_png, input.pdf, output,png)
define convert_to_png_lnx
	convert -density 150 $(1) -quality 90 $(2)
endef
define convert_to_png_mac
	sips -s format png --out $(2) $(1)
endef
 
all: $(OUTPUT).pdf
 
$(OUTPUT).pdf : *.tex revision
	$(PDFLATEX)
	# $(BIBTEX) $(OUTPUT)
	# $(BIBER) $(OUTPUT).bcf
	$(PDFLATEX)
	$(PDFLATEX)

docker: *.tex revision
	docker run -v `pwd`:/source noah95/latex /usr/bin/make

revision:
	mkdir -p build
	echo "% Autogenerated, do not edit" > build/revision.tex
	echo "\\\newcommand{\\\revisiondate}{`git log -1 --format=\"%ad\" --date=iso`}" >> build/revision.tex
	echo "\\\newcommand{\\\revision}{`git log -1 --format=\"%h\"`}" >> build/revision.tex
	echo "\\\newcommand{\\\compiledate}{`date \"+%Y-%m-%d %H:%M:%S\"`}" >> build/revision.tex
	echo "\\\newcommand{\\\hostname}{`hostname`}" >> build/revision.tex


clean:
	$(RM) *.aux *.bbl *.blg *.log *.out *.pdf build
